#
# Generated by erpcgen {$erpcgenVersion} on {$todaysDate}.
#
# AUTOGENERATED - DO NOT EDIT
#

import erpc
from . import common, interface

{% for iface in interfaces %}
# Client for {$iface.name}
class {$iface.name}Service(erpc.server.Service):
    def __init__(self, handler):
        super({$iface.name}Service, self).__init__(interface.I{$iface.name}.SERVICE_ID)
        self._handler = handler
        self._methods = {
{% for fn in iface.functions %}
                interface.I{$iface.name}.{$upper(fn.name)}_ID : self._handle_{$fn.name},
{% endfor -- fn %}
            }

{% for fn in iface.functions %}
    def _handle_{$fn.name}(self, sequence, inCodec, outCodec):
{% if fn.outParameters %}
        # Create reference objects to pass into handler for out/inout parameters.
{%  for p in fn.outParameters if not p.lengthForMember %}
        {$p.name} = erpc.Reference()
{%  endfor -- outParams %}

{% endif -- outParams %}
        # Read incoming parameters.
{% for p in fn.inParameters %}
{%  if p.lengthForMember %}
{%   set p_name = "_" %}
{%  elif p.direction == "in" %}
{%   set p_name = p.name %}
{%  elif p.direction == "inout" %}
{%   set p_name = p.name & ".value" %}
{%  endif -- lengthForMember, dir %}
{%  if p.isNullable %}
        if not inCodec.read_null_flag():
            {$decodeValue(p.type, p_name, "common.", "inCodec", "            ", 0)}
        else:
            {$p.name if p.direction == "in" else p.name & ".value"} = None
{%  else -- isNullable %}
        {$decodeValue(p.type, p_name, "common.", "inCodec", "        ", 0)}
{%  endif -- isNullable %}
{% endfor -- inParams %}
        inCodec.end_read_message()

        # Invoke user implementation of remote function.
        _result = self._handler.{$fn.name}({% for p in fn.parameters if not p.lengthForMember %}{$p.name}{% if not loop.last %}, {% endif %}{% endfor %})
{% if not fn.isOneway %}

        # Construct reply message.
        outCodec.start_write_message(erpc.codec.MessageInfo(
            type=erpc.codec.MessageType.kReplyMessage,
            service=interface.I{$iface.name}.SERVICE_ID,
            request=interface.I{$iface.name}.{$upper(fn.name)}_ID,
            sequence=sequence))
{% for p in fn.outParameters %}
{%  if not p.lengthForMember %}
{%   if p.isNullable %}
        if {$p.name}.value is None:
            outCodec.write_null_flag(True)
        else:
            outCodec.write_null_flag(False)
            {$encodeValue(p.type, p.name & ".value", "outCodec", "            ", 0)}
{%   else -- isNullable %}
        if {$p.name}.value is None:
            raise ValueError("{$p.name} is None")
        {$encodeValue(p.type, p.name & ".value", "outCodec", "        ", 0)}
{%   endif -- isNullable %}
{%  else -- lengthForMember %}
        {$encodeValue(p.type, "len(" & p.lengthForMember & ".value)", "outCodec", "        ", 0)}
{%  endif -- lengthForMember %}
{% endfor -- outParams %}
{% if fn.isReturnValue && fn.returnValue.type.type != "void" %}
        {$encodeValue(fn.returnValue.type, "_result", "outCodec", "        ", 0)}
{% endif -- isReturnValue %}
        outCodec.end_write_message()
{% endif -- isOneway %}

{% endfor -- fn %}

{% endfor -- iface %}
